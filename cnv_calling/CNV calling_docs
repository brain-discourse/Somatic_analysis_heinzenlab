#Panel of normals  - need to be sequenced using same technology 
###Generate region of interest summary for PON
#######BAM to ROI wrapper 
#!/bin/bash
#SBATCH -t 07-00:00:00
#SBATCH --mem=20g

module load r/3.6.0
module load bedtools
module load snpeff

for filename in `cat /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/WGS/bam.list.txt`

do 
sbatch --time=100:00:00 --mem=8g --job-name unzip --wrap="sh /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/WGS/gen.roi.sh $filename"

sleep 1
done

########Generate ROI 
#!/bin/bash
filename=$1

Rscript /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/CNVRadar/CNV_Radar-master/bam2roi.r -b "$filename"  -d /proj/heinzenlab/projects/somaticNov2020/analysisfiles/CCDShg18exons+2bp.GRCh38.p12.CCDSv22.bed -z >> bam2roi.log 2>&1


########Create PON
#!/bin/bash
#SBATCH -t 07-00:00:00
#SBATCH --mem=20g


module load r/3.6.0
module load bedtools
module load snpeff

for f in *_roiSummary.txt ; do Rscript /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/CNVRadar/CNV_Radar-master/CNV_Radar_create_control.r --directory /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/WGS/controls/  >> create_normal_cohort.log 2>&1 ; done

#Actual analysis on real samples 
######Generate ROI (same as above) 
######Annotate (wrapper script)
*gvcfs need to be generated to be able to annotate these files and utilize them for CNV calling 
#!/bin/bash
#SBATCH -N 1
#SBATCH -n 6
#SBATCH -p general
#SBATCH --nice=30 
#SBATCH -t 07-00:00:00
#SBATCH --mem=140g

module load r/3.6.0
module load bedtools
module load snpeff/

for filename in `cat /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/WGS/vcf.list`
do 
sbatch --time=100:00:00 --mem=8g --job-name unzip --wrap="sh /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/Agilent/annotate.sh $filename"
sleep 1
done

#########Annotate files 
#!/bin/bash
filename=$1
java -jar /nas/longleaf/apps/snpeff/4.3/snpEff/SnpSift.jar annotate /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/dbSnp/All_20180418.vcf.gz "$filename" | bgzip > $(basename "$filename" .ext).annotated


########CNV calling (once the annotation, PON, and roi files are ready, run this) 
#!/bin/bash
#SBATCH -N 1
#SBATCH -n 6
#SBATCH -p general
#SBATCH --nice=30 
#SBATCH -t 07-00:00:00
#SBATCH --mem=320g
module load r/4.0.1
module load bedtools
module load snpeff/4.3

Rscript /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/CNVRadar/CNV_Radar.r -c /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/WGS/controls/cnvradar_normal_cohort.RData -r /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/WGS/JME304_ATTCCATA-TGCCTGGT_S1_sorted_roiSummary.txt -v /proj/heinzenlab/projects/somaticNov2020/germline/CNV_MG/WGS/JME304.g.vcf.gz.annotated  -G


